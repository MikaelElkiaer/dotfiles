#!/usr/bin/env bash

set -euo pipefail

function main() {
  WINDOW_ID="$1"
  WINDOW_INDEX="$2"

  mapfile -t PANES < <(tmux list-panes -F "#{pane_current_command} #{pane_current_path} #{pane_active}" -t "$WINDOW_ID")

  local ACTIVE_PATH RESULT
  for P in "${PANES[@]}"; do
    local FORMAT=""
    read -r APP _PATH ACTIVE <<<"$P"
    if [ "$ACTIVE" == "1" ]; then
      ACTIVE_PATH=$_PATH
      FORMAT+="#[fg=colour4]"
    fi
    FORMAT+="$(get_app_icon "$APP")"
    FORMAT+=" "
    FORMAT+="#[fg=default]"
    RESULT+="$FORMAT"
  done
  if [ "$ACTIVE_PATH" == "$HOME" ]; then
    ACTIVE_PATH="~"
  fi
  RESULT+="$(basename "$ACTIVE_PATH")"
  RESULT+="$(get_superscript "$WINDOW_INDEX")"
  echo "$RESULT"
}

function get_app_icon() {
  case "$1" in
  "bash" | "sh")
    echo ""
    ;;
  "k9s")
    echo "󱃾"
    ;;
  "nvim")
    echo ""
    ;;
  *)
    echo " "
    ;;
  esac
}

function get_superscript() {
  case "$1" in
  "0")
    echo "⁰"
    ;;
  "1")
    echo "¹"
    ;;
  "2")
    echo "²"
    ;;
  "3")
    echo "³"
    ;;
  "4")
    echo "⁴"
    ;;
  "5")
    echo "⁵"
    ;;
  "6")
    echo "⁶"
    ;;
  "7")
    echo "⁷"
    ;;
  "8")
    echo "⁸"
    ;;
  "9")
    echo "⁹"
    ;;
  *)
    echo "⁺"
    ;;
  esac
}

main "$@"
